<?xml version="1.0" encoding="UTF-8" ?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <sampleQuery> select * from {table}</sampleQuery>
  </meta>
  <bindings>
    <select produces="JSON">
      <urls>
        <url></url>
      </urls>
      <paging model="offset">
        <pagesize id="count" max="300" />
        <total default="10" />
      </paging>
      <inputs>
        <key id='url' type='xs:string' paramType='variable' />
      </inputs>
      <execute><![CDATA[

var keepvid_url;
if(url.toLowerCase().match('youtube.com/')){ 
var querystring = "use 'http://www.datatables.org/regex/regex.xml';select match8, match5, match2 from regex where expression='(&fmt_list=)([^&]*)(.*)(&t=)([^&]*)(.*)(video_id=)([^&]*)(&.*)' and text in (select content from html where url='" + url + "')";

var results= y.query(querystring).results;

var video_id = results.matches.match8.toString();
var signature = results.matches.match5.toString();
var fmt_list= results.matches.match2.toString();

keepvid_url  = 'http://www.keepvid.com/?url=http://www.youtube.com/watch' 
keepvid_url += '%3Fv%3D'+video_id;
keepvid_url += escape('&vid=')+video_id;
keepvid_url += escape('&tid=')+signature;
keepvid_url += escape('&flid=')+fmt_list;
keepvid_url += escape('&titleid=')+'Foo';

y.log(keepvid_url)

}
else{ 
    keepvid_url='http://www.keepvid.com/?url='+escape(url);
}


response.object = keepvid_url.toString()
//response.object = y.query("select * from html where url='" + keepvid_url + "'").results

      ]]></execute>
    </select>
  </bindings>
</table>