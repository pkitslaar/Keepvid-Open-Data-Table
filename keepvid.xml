<?xml version="1.0" encoding="UTF-8" ?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <sampleQuery> select * from {table}</sampleQuery>
  </meta>
  <bindings>
    <select produces="XML">
      <urls>
        <url></url>
      </urls>
      <paging model="offset">
        <pagesize id="count" max="300" />
        <total default="10" />
      </paging>
      <inputs>
        <key id='url' type='xs:string' paramType='variable' />
      </inputs>
      <execute><![CDATA[

function inbtwn(a,b,c){ 
    try{ 
        var a1 = a.split(b);
        var a2 = a1[1].split(c);
         return a2[0];
     } 
    catch(err){return ''; }
} 

function inbtwn2(a,b,c){ 
    try{
    var a1 = a.split(b);
 var a2 = a1[2].split(c);
 return a2[0];
 }
 catch(err) {return ''; } 
} 



var keepvid_url;
if(url.toLowerCase().match('youtube.com/')){ 
var querystring = "select * from html where url = '"+url+"' and xpath='*'";
var results = y.query(querystring).results;
var src = response.object = results.content.toString()


    var v = inbtwn(src, 'video_id=', '&');
    var t = inbtwn(src, '&t=', '&');
    var fl = inbtwn(src, '&fmt_list=', '&');
    var title = inbtwn2(src, 'title=%22', '%22');
    if(title == ''){ 
    title = inbtwn(src, '%3Ch1 id=%22vt%22%3E', '%3C');
    };
    if(v != '' && t != ''){
        keepvid_url = 'http://www.keepvid.com/?url=http://www.youtube.com/watch%3Fv%3D'+v+'&vid='+v+'&tid='+t+'&flid='+fl+'&titleid='+title;
    }
    else{
        keepvid_url ='http://www.keepvid.com/?url='+escape(url);
    }
    keepvid_url = src;
}
else{ 
    keepvid_url='http://www.keepvid.com/?url='+escape(url);
}

response.object = keepvid_url





      ]]></execute>
    </select>
  </bindings>
</table>